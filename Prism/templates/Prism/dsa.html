{% extends "Prism/layout.html" %}

{% block title %}
Pri2m : {{ grant.kristalref|default_if_none:"Grant" }}
{% endblock %}

{% block content %}

<h1>DSA - {{ dsa.dsaname }}</h1>

{% if custom_errors %}
<ul>
    {% for error in custom_errors %}
        <li class="form-custom-error">{{error}}</li>
    {% endfor %}
</ul>
{% endif %}

{% if dsa_form.non_field_errors %}
<ul>
    {% for error in dsa_form.non_field_errors %}
        <li class="form-error">{{error}}</li>
    {% endfor %}
</ul>
{% endif %}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <form action="" method = "POST">
                {% csrf_token %}
                <p><input class="btn btn-primary" type="submit" value="Submit"></p>
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-auto">
                            <legend>Data Owner</legend>
                            <fieldset>
                                <p>{{ dsa_form.dataowner_id.as_field_group }}</p>
                                <p>{{ dsa_form.agreementowneremail.as_field_group }}</p>
                            </fieldset>
                        </div>
                        <div class="col-md-auto">
                            <legend>File Details</legend>
                            <fieldset>
                                <p>{{ dsa_form.dsaname.as_field_group }}</p>
                                <p>{{ dsa_form.dsafileloc.as_field_group }}</p>
                            </fieldset>
                        </div>
                        <div class="col-md-auto">
                            <legend>Dates</legend>
                            <fieldset>
                                <p>{{ dsa_form.startdate.as_field_group }}</p>
                                <p>{{ dsa_form.expirydate.as_field_group }}</p>
                                <p>{{ dsa_form.datadestructiondate.as_field_group }}</p>
                            </fieldset>
                        </div>
                        <div class="col-md-auto">
                            <legend>Governance</legend>
                            <fieldset>
                                <p>{{ dsa_form.dspt.as_field_group }}</p>
                                <p>{{ dsa_form.iso27001.as_field_group }}</p>
                                <p>{{ dsa_form.requiresencryption.as_field_group }}</p>
                                <p>{{ dsa_form.noremoteaccess.as_field_group }}</p>
                            </fieldset>
                            <fieldset>
                                {{ dsa_form.dsaid }}
                                {{ dsa_form.validfrom }}
                                {{ dsa_form.validto }}
                            </fieldset>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <legend>Projects</legend>
                        <form action="" method="POST">
                            {% csrf_token %}
                            <fieldset>
                                <div class="input-group">
                                    {{ dsa_project_form.documentid.as_hidden }}
                                    {{ dsa_project_form.project }}
                                    <input class="btn btn-primary" type="submit" value="Add project">
                                </div>
                            </fieldset>
                        </form>
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Project Number</th>
                                    <th scope="col">Project Name</th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in dsa_project %}
                                    <tr>
                                        <td><a href='/project/{{ item.project }}'>{{ item.project }}</td>
                                        <td>{{ item.projectname }}</td>
                                        <td><a href='/remove/projectdsa/{{ item.dpid }}'>x</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <div class="container-fluid">
                            {% if notes_filter %}
                                <legend>Notes containing "{{ notes_filter }}" (<a href='/dsa/{{ dsa.documentid }}'>clear</a>)</legend>
                            {% else %}
                                <legend>Notes</legend> 
                            {% endif %}

                            <div class="row">
                                <div class="col-md-8">
                                    <form action="" method="POST">
                                        {% csrf_token %}
                                        <fieldset>
                                            <div class="input-group">
                                                {{ new_note.note }}
                                                <input class="btn btn-primary" type="submit" value="Add note">
                                            </div>
                                        </fieldset>
                                        <fieldset>
                                            {{ new_note.dnid }}
                                            {{ new_note.dsa }}
                                            {{ new_note.created }}
                                            {{ new_note.createdby }}
                                        </fieldset>
                                    </form>
                                </div>

                                <div class="col-md-4">
                                    <form action="" method="get">
                                        <div class="input-group">
                                            <input name="search_notes" type="text" class="form-control" placeholder="Search...">
                                            <button class="btn btn-primary" type="submit" id="button-search">Search</button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                            <th scope="col">Note</th>
                                            <th style="white-space: nowrap;" scope="col">Created</th>
                                            <th style="white-space: nowrap;" scope="col">Created By</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for note in notes.object_list %}
                                                <tr>
                                                    <td>{{ note.note }}</td>
                                                    <td style="white-space: nowrap;">{{ note.created | date:"Y-m-d" }}</td>
                                                    <td style="white-space: nowrap;">{{ note.createdby }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>

                                    <div class="pagination">
                                        <ul class="pagination pagination-sm">
                                        {% if notes.has_previous %}
                                            <li class="page-item">
                                                {% if notes_filter %}
                                                    <a class="page-link" href="?search_notes={{ notes_filter }}&page={{ notes.previous_page_number }}">&laquo;</a>
                                                {% else %}
                                                    <a class="page-link" href="?page={{ notes.previous_page_number }}">&laquo;</a>
                                                {% endif %}
                                            </li>
                                        {% else %}
                                            <li class="page-item disabled">
                                                <a class="page-link" href="#">&laquo;</a>
                                            </li>
                                        {% endif %}

                                        {% for num in notes.paginator.page_range %}
                                            {% if notes.number == num %}
                                                <li class="page-item active">
                                                    {% if notes_filter %}
                                                        <a class="page-link" href="?search_notes={{ notes_filter }}&page={{ num }}">{{ num }}</a>
                                                    {% else %}
                                                        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                                    {% endif %}
                                                </li>
                                            {% else %}
                                                <li class="page-item">
                                                    {% if notes_filter %}
                                                        <a class="page-link" href="?search_notes={{ notes_filter }}&page={{ num }}">{{ num }}</a>
                                                    {% else %}
                                                        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                                    {% endif %}
                                                </li>
                                            {% endif %}
                                        {% endfor %}

                                        {% if notes.has_next %}
                                            <li class="page-item">
                                                {% if notes_filter %}
                                                    <a class="page-link" href="?search_notes={{ notes_filter }}&page={{ notes.next_page_number }}">&raquo;</a>
                                                {% else %}
                                                    <a class="page-link" href="?page={{ notes.next_page_number }}">&raquo;</a>
                                                {% endif %}
                                            </li>
                                        {% else %}
                                            <li class="page-item disabled">
                                                <a class="page-link" href="#">&raquo;</a>
                                            </li>
                                        {% endif %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}